{"ast":null,"code":"var _jsxFileName = \"/home/crmock/pideenlaequina/front/components/Map.js\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport distance from './Distance';\nconst initialZoom = 14;\n\nclass Map extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      map: null,\n      userMarker: null,\n      storeMarkers: [],\n      selectedStore: null\n    };\n  }\n\n  componentDidMount() {\n    this.setState({\n      map: null\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(this.props.selectedStore);\n\n    if (this.props.pos !== null && (this.props.stores !== null && this.props.stores !== undefined || this.props.selectedStore !== null && this.props.selectedStore !== undefined)) {\n      if (this.state.map === null) {\n        let map = this.getMap(this.props.pos);\n        let userMarker = this.placeUserMarker(map, this.props.pos);\n        let storeMarkers = null;\n        let selectedStore = null;\n\n        if (this.props.stores !== null && this.props.stores !== undefined) {\n          storeMarkers = this.placeAllStoreMarkers(map, this.props.stores);\n        }\n\n        if (this.props.selectedStore !== null && this.props.selectedStore !== undefined) {\n          selectedStore = this.placeAStoreMarker(map, this.props.selectedStore, true);\n        }\n\n        this.setState({\n          userMarker: userMarker,\n          map: map,\n          storeMarkers: storeMarkers,\n          selectedStore: selectedStore\n        });\n      }\n\n      if (this.state.map !== null && prevProps.pos !== this.props.pos) {\n        let userMarker = this.placeUserMarker(this.state.map, this.props.pos);\n        this.removeAllStoreMarkers();\n        this.setState({\n          userMarker: userMarker\n        });\n      }\n\n      if (this.state.map !== null && prevProps.stores !== this.props.stores) {\n        this.removeAllStoreMarkers();\n        let storeMarkers = this.placeAllStoreMarkers(this.state.map, this.props.stores);\n        this.setState({\n          storeMarkers: storeMarkers\n        });\n      }\n\n      if (this.state.map !== null && prevProps.selectedStore !== this.props.selectedStore) {\n        this.removeSelectedStoreMarker();\n        let selectedStore = this.placeAStoreMarker(this.state.map, this.props.selectedStore);\n        this.setState({\n          selectedStore: selectedStore\n        });\n      }\n    }\n  }\n\n  getMap(pos) {\n    let map = null;\n\n    if (this.state.map == null) {\n      map = new google.maps.Map(document.getElementById(this.props.htmlId), {\n        center: pos,\n        zoom: initialZoom,\n        zoomControl: false,\n        mapTypeControl: false,\n        fullscreenControl: false,\n        clickableIcons: false,\n        streetViewControl: false\n      });\n    } else {\n      map = this.state.map;\n    }\n\n    return map;\n  }\n\n  placeUserMarker(map, pos, pan = true) {\n    if (this.state.userMarker != null) {\n      this.state.userMarker.setMap(null);\n    }\n\n    let marker = new google.maps.Marker({\n      position: pos,\n      icon: './map/user_icon.svg',\n      title: \"Tu ubicación\",\n      draggable: false\n    });\n    marker.setMap(map);\n\n    if (pan) {\n      this.panToPos(map, pos);\n    }\n\n    return marker;\n  }\n\n  panToPos(map, pos, zoom = initialZoom) {\n    map.setZoom(zoom);\n    map.panTo(pos);\n  }\n\n  placeAllStoreMarkers(map, stores) {\n    let list = [];\n\n    for (let i = 0; i < stores.length; i++) {\n      let store = stores[i];\n\n      if (store._id == null || store.lat == null || store.lng == null || store.name == null) {\n        console.log(\"Skiped store: \" + store.name);\n        continue;\n      }\n\n      let marker = this.placeAStoreMarker(map, store);\n      list.push(marker);\n    }\n\n    return list;\n  }\n\n  removeAllStoreMarkers() {\n    for (let i = 0; i < this.state.storeMarkers.length; i++) {\n      this.state.storeMarkers[i].setMap(null);\n    }\n  }\n\n  removeSelectedStoreMarker() {\n    this.state.selectedStore.setMap(null);\n  }\n\n  placeAStoreMarker(map, store, selected = false) {\n    let categories = ['pharmacy', 'bakery', 'vegetableStore', 'hardwareStore', 'butchery', 'drycleaner', 'stationeryStore', 'petStore', 'liquorStore', 'fastFood', 'restaurant', 'groeceryStore', 'store'];\n    let labels = ['Droguería', 'Panadería', 'Fruver', 'Ferretería', 'Carnicería', 'Lavandería', 'Papelería', 'Mascotas', 'Licorera', 'Comida rápida', 'Restaurante', 'Tienda', 'Otro'];\n\n    if (store.type === null) {\n      store.type = \"store\";\n    }\n\n    if (!categories.includes(store.type)) {\n      store.type = \"store\";\n    }\n\n    let i = categories.indexOf(store.type);\n    store.typeLabel = labels[i];\n    let icon = '';\n\n    if (selected) {\n      icon = './map/' + store.type + \"_icon_selected.svg\";\n    } else {\n      icon = './map/' + store.type + \"_icon.svg\";\n    }\n\n    let icon_hover = './map/' + store.type + \"_icon_hover.svg\";\n    let marker = new google.maps.Marker({\n      position: {\n        lat: store.lat,\n        lng: store.lng\n      },\n      icon: icon,\n      title: store.name,\n      draggable: false,\n      //custom data\n      selected: selected,\n      id: store._id,\n      distance: distance(this.props.pos.lat, this.props.pos.lng, store.lat, store.lng),\n      onClickFunction: id => this.handleStoreMarkerClick(id)\n    });\n    google.maps.event.addListener(marker, 'click', function () {\n      if (!marker.selected) {\n        marker.onClickFunction(marker.id);\n      }\n    });\n    google.maps.event.addListener(marker, 'mouseover', function () {\n      marker.setIcon(icon_hover);\n    });\n    google.maps.event.addListener(marker, 'mouseout', function () {\n      marker.setIcon(icon);\n    });\n    marker.setMap(map);\n    return marker;\n  }\n\n  findStore(id) {\n    for (let i = 0; i < this.props.stores.length; i++) {\n      const element = this.props.stores[i];\n\n      if (element._id === id) {\n        return element;\n      }\n    }\n\n    return null;\n  }\n\n  handleStoreMarkerClick(id) {\n    let store = this.findStore(id);\n\n    if (store !== null) {\n      this.props.openSelectedStore(store);\n    }\n  }\n\n  render() {\n    return __jsx(\"div\", {\n      style: {\n        height: \"100%\",\n        width: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      id: this.props.htmlId,\n      style: {\n        height: \"100%\",\n        width: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nexport default Map;","map":{"version":3,"sources":["/home/crmock/pideenlaequina/front/components/Map.js"],"names":["React","distance","initialZoom","Map","Component","constructor","props","state","map","userMarker","storeMarkers","selectedStore","componentDidMount","setState","componentDidUpdate","prevProps","prevState","console","log","pos","stores","undefined","getMap","placeUserMarker","placeAllStoreMarkers","placeAStoreMarker","removeAllStoreMarkers","removeSelectedStoreMarker","google","maps","document","getElementById","htmlId","center","zoom","zoomControl","mapTypeControl","fullscreenControl","clickableIcons","streetViewControl","pan","setMap","marker","Marker","position","icon","title","draggable","panToPos","setZoom","panTo","list","i","length","store","_id","lat","lng","name","push","selected","categories","labels","type","includes","indexOf","typeLabel","icon_hover","id","onClickFunction","handleStoreMarkerClick","event","addListener","setIcon","findStore","element","openSelectedStore","render","height","width"],"mappings":"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","sourcesContent":["import React from 'react'\nimport distance from './Distance'\n\nconst initialZoom = 14\n\nclass Map extends React.Component {\n\n  constructor(props)\n  {\n    super(props)\n    this.state = {\n      map: null,\n      userMarker:null,\n      storeMarkers:[],\n      selectedStore: null\n    }\n  }\n\n  componentDidMount()\n  {\n    this.setState({map:null}) \n  }\n\n  componentDidUpdate(prevProps, prevState) \n  {\n    console.log(this.props.selectedStore)\n    if(this.props.pos !== null \n      && (\n        (this.props.stores !== null && this.props.stores!== undefined)\n        || (this.props.selectedStore !== null && this.props.selectedStore!== undefined)\n      )\n    )\n    {\n      if(this.state.map === null)\n      {\n        let map=this.getMap(this.props.pos)\n        let userMarker=this.placeUserMarker(map, this.props.pos)\n        let storeMarkers=null \n        let selectedStore=null\n\n        if(this.props.stores!==null && this.props.stores!== undefined)\n        {\n          storeMarkers = this.placeAllStoreMarkers(map, this.props.stores)\n        }\n        \n        if(this.props.selectedStore!==null && this.props.selectedStore!== undefined)\n        {\n          selectedStore = this.placeAStoreMarker(map, this.props.selectedStore, true)\n        }\n\n        this.setState ({\n          userMarker:userMarker,\n          map: map,\n          storeMarkers: storeMarkers,\n          selectedStore: selectedStore\n        })\n      }\n      \n      if(this.state.map !== null && prevProps.pos !== this.props.pos)\n      {\n        let userMarker=this.placeUserMarker(this.state.map, this.props.pos)\n        this.removeAllStoreMarkers()\n\n        this.setState ({\n          userMarker:userMarker\n        })\n      }\n\n      if(this.state.map !== null && prevProps.stores !== this.props.stores)\n      {\n        this.removeAllStoreMarkers()\n        let storeMarkers = this.placeAllStoreMarkers(this.state.map, this.props.stores)\n\n        this.setState ({\n          storeMarkers: storeMarkers\n        })\n      }\n      \n      if(this.state.map !== null && prevProps.selectedStore !== this.props.selectedStore)\n      {\n        this.removeSelectedStoreMarker()\n        let selectedStore = this.placeAStoreMarker(this.state.map, this.props.selectedStore)\n\n        this.setState ({\n          selectedStore: selectedStore\n        })\n      }\n    }\n  }\n\n  getMap(pos)\n  {\n    let map = null\n    if(this.state.map == null)\n    {\n      map = new google.maps.Map(document.getElementById(this.props.htmlId), {\n        center: pos,\n        zoom: initialZoom,\n        zoomControl:false,\n        mapTypeControl: false,\n        fullscreenControl: false,\n        clickableIcons: false,\n        streetViewControl: false\n      })\n    }\n    else\n    {\n      map = this.state.map\n    }\n    return map\n  }\n\n  placeUserMarker(map, pos, pan=true)\n  {\n    if(this.state.userMarker != null)\n    {\n      this.state.userMarker.setMap(null);\n    }\n\n    let marker = new google.maps.Marker({\n      position: pos,\n      icon: './map/user_icon.svg',\n      title: \"Tu ubicación\",\n      draggable:false,\n    })\n\n    marker.setMap(map);\n\n    if(pan)\n    {\n      this.panToPos(map, pos)\n    }\n\n    return marker\n  }\n\n  panToPos(map, pos, zoom=initialZoom)\n  {\n    map.setZoom(zoom);\n    map.panTo(pos);\n  }\n\n  placeAllStoreMarkers(map, stores)\n  {\n    let list = []\n    \n    for (let i = 0; i < stores.length; i++) {\n      let store = stores[i]\n      if(store._id == null || store.lat == null || store.lng == null || store.name == null)\n      {\n        console.log(\"Skiped store: \"+store.name)\n        continue\n      }\n\n      let marker = this.placeAStoreMarker(map, store)\n      list.push(marker)\n    }\n\n    return list\n  }\n\n  removeAllStoreMarkers()\n  {\n    for (let i = 0; i < this.state.storeMarkers.length; i++)\n    {\n      this.state.storeMarkers[i].setMap(null)\n    }\n  }\n\n  removeSelectedStoreMarker()\n  {\n    this.state.selectedStore.setMap(null)\n  }\n\n  placeAStoreMarker(map, store, selected=false)\n  {\n    let categories=[\n      'pharmacy', \n      'bakery', \n      'vegetableStore', \n      'hardwareStore',\n      'butchery', \n      'drycleaner',\n      'stationeryStore',\n      'petStore',\n      'liquorStore',\n      'fastFood',\n      'restaurant',\n      'groeceryStore',\n      'store'\n    ]\n\n    let labels=[\n      'Droguería',\n      'Panadería',\n      'Fruver',\n      'Ferretería',\n      'Carnicería',\n      'Lavandería',\n      'Papelería',\n      'Mascotas',\n      'Licorera',\n      'Comida rápida',\n      'Restaurante',\n      'Tienda',\n      'Otro'\n    ]\n\n    if(store.type===null)\n    {\n      store.type=\"store\"\n    }\n\n    if(!categories.includes(store.type))\n    {\n      store.type=\"store\"\n    }\n    \n    let i = categories.indexOf(store.type)\n    store.typeLabel = labels[i]\n\n    let icon = '';\n    if(selected)\n    {\n      icon = './map/' + store.type + \"_icon_selected.svg\";\n    }\n    else\n    {\n      icon = './map/' + store.type + \"_icon.svg\";\n    }\n    let icon_hover = './map/' + store.type + \"_icon_hover.svg\";\n    \n    let marker = new google.maps.Marker({\n      position: {lat:store.lat, lng:store.lng},\n      icon: icon,\n      title:store.name,\n      draggable:false,\n      //custom data\n      selected:selected,\n      id:store._id,\n      distance:distance(this.props.pos.lat, this.props.pos.lng, store.lat, store.lng),\n      onClickFunction: ((id)=>this.handleStoreMarkerClick(id))\n    })\n\n    google.maps.event.addListener(marker, 'click', function() {\n      if(!marker.selected)\n      {\n        marker.onClickFunction(marker.id)\n      }\n    })\n\n    google.maps.event.addListener(marker, 'mouseover', function() {\n      marker.setIcon(icon_hover);\n    })\n\n    google.maps.event.addListener(marker, 'mouseout', function() {\n      marker.setIcon(icon);    \n    })\n\n    marker.setMap(map)\n    return marker\n  }\n\n  findStore(id)\n  {\n    for (let i = 0; i < this.props.stores.length; i++) {\n      const element = this.props.stores[i];\n\n      if(element._id === id)\n      {\n        return element\n      }\n    }\n    return null\n  }\n\n  handleStoreMarkerClick(id)\n  {\n    let store = this.findStore(id)\n\n    if(store !== null)\n    {\n      this.props.openSelectedStore(store)\n    }\n  }\n\n  render () {\n    return (\n      <div style={{height:\"100%\", width:'100%'}}>\n        <div id={this.props.htmlId} style={{height:\"100%\", width:'100%'}}></div>\n      </div>\n    )\n  }\n}\n\nexport default Map\n"]},"metadata":{},"sourceType":"module"}