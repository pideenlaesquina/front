{"ast":null,"code":"// Import Dependencies\nconst url = require('url');\n\nconst MongoClient = require('mongodb').MongoClient; // Create cached connection variable\n\n\nlet cachedDb = null; // A function for connecting to MongoDB,\n// taking a single parameter of the connection string\n\nasync function connectToDatabase() {\n  // If the database connection is cached,\n  // use it instead of creating a new connection\n  if (cachedDb) {\n    return cachedDb;\n  } // If no connection is cached, create a new one\n\n\n  const client = await MongoClient.connect(process.env.MONGODB_URI, {\n    useNewUrlParser: true\n  }); // Select the database through the connection,\n  // using the database path of the connection string\n\n  const db = await client.db(url.parse(uri).pathname.substr(1)); // Cache the database connection and return the connection\n\n  cachedDb = db;\n  return db;\n}\n\nconst db = connectToDatabase(uri);\nexport default db;","map":{"version":3,"sources":["/home/crmock/pideenlaequina/front/middleware/mongodb.js"],"names":["url","require","MongoClient","cachedDb","connectToDatabase","client","connect","process","env","MONGODB_URI","useNewUrlParser","db","parse","uri","pathname","substr"],"mappings":"AAAA;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAC,SAAD,CAAP,CAAmBC,WAAvC,C,CAEA;;;AACA,IAAIC,QAAQ,GAAG,IAAf,C,CAEA;AACA;;AACA,eAAeC,iBAAf,GAAmC;AACjC;AACA;AACA,MAAID,QAAJ,EAAc;AACZ,WAAOA,QAAP;AACD,GALgC,CAOjC;;;AACA,QAAME,MAAM,GAAG,MAAMH,WAAW,CAACI,OAAZ,CAAoBC,OAAO,CAACC,GAAR,CAAYC,WAAhC,EAA6C;AAAEC,IAAAA,eAAe,EAAE;AAAnB,GAA7C,CAArB,CARiC,CAUjC;AACA;;AACA,QAAMC,EAAE,GAAG,MAAMN,MAAM,CAACM,EAAP,CAAUX,GAAG,CAACY,KAAJ,CAAUC,GAAV,EAAeC,QAAf,CAAwBC,MAAxB,CAA+B,CAA/B,CAAV,CAAjB,CAZiC,CAcjC;;AACAZ,EAAAA,QAAQ,GAAGQ,EAAX;AACA,SAAOA,EAAP;AACD;;AAED,MAAMA,EAAE,GAAGP,iBAAiB,CAACS,GAAD,CAA5B;AAEA,eAAeF,EAAf","sourcesContent":["// Import Dependencies\nconst url = require('url')\nconst MongoClient = require('mongodb').MongoClient\n\n// Create cached connection variable\nlet cachedDb = null\n\n// A function for connecting to MongoDB,\n// taking a single parameter of the connection string\nasync function connectToDatabase() {\n  // If the database connection is cached,\n  // use it instead of creating a new connection\n  if (cachedDb) {\n    return cachedDb\n  }\n\n  // If no connection is cached, create a new one\n  const client = await MongoClient.connect(process.env.MONGODB_URI, { useNewUrlParser: true })\n\n  // Select the database through the connection,\n  // using the database path of the connection string\n  const db = await client.db(url.parse(uri).pathname.substr(1))\n\n  // Cache the database connection and return the connection\n  cachedDb = db\n  return db\n}\n\nconst db = connectToDatabase(uri);\n\nexport default db;"]},"metadata":{},"sourceType":"module"}