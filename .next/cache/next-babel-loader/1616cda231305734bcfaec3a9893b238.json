{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/crmock/pideenlaequina/front/components/Map.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport distance from './Distance';\nvar initialZoom = 15;\n\nvar Map = /*#__PURE__*/function (_React$Component) {\n  _inherits(Map, _React$Component);\n\n  var _super = _createSuper(Map);\n\n  function Map(props) {\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      map: null,\n      userMarker: null,\n      storeMarkers: [],\n      selectedStore: null\n    };\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        map: null\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (this.props.pos !== null && (this.props.stores !== null || this.props.selectedStore !== null)) {\n        if (this.state.map === null) {\n          var map = this.getMap(this.props.pos);\n          var userMarker = this.placeUserMarker(map, this.props.pos);\n          var storeMarkers = null;\n          var selectedStore = null;\n\n          if (this.props.stores !== null) {\n            storeMarkers = this.placeAllStoreMarkers(map, this.props.stores);\n          }\n\n          console.log(this.props.selectedStore);\n\n          if (this.props.selectedStore !== null) {\n            selectedStore = this.placeAStoreMarker(map, this.props.selectedStore, true);\n          }\n\n          this.setState({\n            userMarker: userMarker,\n            map: map,\n            storeMarkers: storeMarkers,\n            selectedStore: selectedStore\n          });\n        }\n\n        if (this.state.map !== null && prevProps.pos !== this.props.pos) {\n          var _userMarker = this.placeUserMarker(this.state.map, this.props.pos);\n\n          this.removeAllStoreMarkers();\n          this.setState({\n            userMarker: _userMarker\n          });\n        }\n\n        if (this.state.map !== null && prevProps.stores !== this.props.stores) {\n          this.removeAllStoreMarkers();\n\n          var _storeMarkers = this.placeAllStoreMarkers(this.state.map, this.props.stores);\n\n          this.setState({\n            storeMarkers: _storeMarkers\n          });\n        }\n\n        if (this.state.map !== null && prevProps.selectedStore !== this.props.selectedStore) {\n          this.removeSelectedStoreMarker();\n\n          var _selectedStore = this.placeAStoreMarker(this.state.map, this.props.selectedStore);\n\n          this.setState({\n            selectedStore: _selectedStore\n          });\n        }\n      }\n    }\n  }, {\n    key: \"getMap\",\n    value: function getMap(pos) {\n      var map = null;\n\n      if (this.state.map == null) {\n        map = new google.maps.Map(document.getElementById(this.props.htmlId), {\n          center: pos,\n          zoom: initialZoom,\n          zoomControl: false,\n          mapTypeControl: false,\n          fullscreenControl: false,\n          clickableIcons: false,\n          streetViewControl: false\n        });\n      } else {\n        map = this.state.map;\n      }\n\n      return map;\n    }\n  }, {\n    key: \"placeUserMarker\",\n    value: function placeUserMarker(map, pos) {\n      var pan = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n\n      if (this.state.userMarker != null) {\n        this.state.userMarker.setMap(null);\n      }\n\n      var marker = new google.maps.Marker({\n        position: pos,\n        icon: './map/user_icon.svg',\n        title: \"Tu ubicación\",\n        draggable: false\n      });\n      marker.setMap(map);\n\n      if (pan) {\n        this.panToPos(map, pos);\n      }\n\n      return marker;\n    }\n  }, {\n    key: \"panToPos\",\n    value: function panToPos(map, pos) {\n      var zoom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : initialZoom;\n      map.setZoom(zoom);\n      map.panTo(pos);\n    }\n  }, {\n    key: \"placeAllStoreMarkers\",\n    value: function placeAllStoreMarkers(map, stores) {\n      var list = [];\n\n      for (var i = 0; i < stores.length; i++) {\n        var store = stores[i];\n\n        if (store._id == null || store.lat == null || store.lng == null || store.name == null) {\n          console.log(\"Skiped store: \" + store.name);\n          continue;\n        }\n\n        var marker = this.placeAStoreMarker(map, store);\n        list.push(marker);\n      }\n\n      return list;\n    }\n  }, {\n    key: \"removeAllStoreMarkers\",\n    value: function removeAllStoreMarkers() {\n      for (var i = 0; i < this.state.storeMarkers.length; i++) {\n        this.state.storeMarkers[i].setMap(null);\n      }\n    }\n  }, {\n    key: \"removeSelectedStoreMarker\",\n    value: function removeSelectedStoreMarker() {\n      this.state.selectedStore.setMap(null);\n    }\n  }, {\n    key: \"placeAStoreMarker\",\n    value: function placeAStoreMarker(map, store) {\n      var selected = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var categories = ['pharmacy', 'bakery', 'vegetableStore', 'hardwareStore', 'butchery', 'drycleaner', 'stationeryStore', 'petStore', 'liquorStore', 'fastFood', 'restaurant', 'groeceryStore', 'store'];\n      var labels = ['Droguería', 'Panadería', 'Fruver', 'Ferretería', 'Carnicería', 'Lavandería', 'Papelería', 'Mascotas', 'Licorera', 'Comida rápida', 'Restaurante', 'Tienda', 'Otro'];\n\n      if (store.type === null) {\n        store.type = \"store\";\n      }\n\n      if (!categories.includes(store.type)) {\n        store.type = \"store\";\n      }\n\n      var i = categories.indexOf(store.type);\n      store.typeLabel = labels[i];\n      var icon = '';\n\n      if (selected) {\n        icon = './map/' + store.type + \"_icon_selected.svg\";\n      } else {\n        icon = './map/' + store.type + \"_icon.svg\";\n      }\n\n      var icon_hover = './map/' + store.type + \"_icon_hover.svg\";\n      var marker = new google.maps.Marker({\n        position: {\n          lat: store.lat,\n          lng: store.lng\n        },\n        icon: icon,\n        title: store.name,\n        draggable: false,\n        //custom data\n        selected: selected,\n        id: store._id,\n        distance: distance(this.props.pos.lat, this.props.pos.lng, store.lat, store.lng)\n      });\n      google.maps.event.addListener(marker, 'click', function () {\n        if (!marker.selected) {\n          this.handleStoreMarkerClick(marker.id);\n        }\n      });\n      google.maps.event.addListener(marker, 'mouseover', function () {\n        marker.setIcon(icon_hover);\n      });\n      google.maps.event.addListener(marker, 'mouseout', function () {\n        marker.setIcon(icon);\n      });\n      marker.setMap(map);\n      return marker;\n    }\n  }, {\n    key: \"findStore\",\n    value: function findStore(id) {\n      for (var i = 0; i < this.props.stores.length; i++) {\n        var element = this.props.stores[i];\n\n        if (element._id === id) {\n          return element;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"handleStoreMarkerClick\",\n    value: function handleStoreMarkerClick(id) {\n      alert(\"ya merito\");\n      var store = this.findStore();\n\n      if (store !== null) {\n        alert(\"ya mero merito\");\n        this.props.openSelectedStore(store);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(\"div\", {\n        style: {\n          height: \"100%\",\n          width: '100%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 7\n        }\n      }, __jsx(\"div\", {\n        id: this.props.htmlId,\n        style: {\n          height: \"100%\",\n          width: '100%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return Map;\n}(React.Component);\n\nexport default Map;","map":{"version":3,"sources":["/home/crmock/pideenlaequina/front/components/Map.js"],"names":["React","distance","initialZoom","Map","props","state","map","userMarker","storeMarkers","selectedStore","setState","prevProps","prevState","pos","stores","getMap","placeUserMarker","placeAllStoreMarkers","console","log","placeAStoreMarker","removeAllStoreMarkers","removeSelectedStoreMarker","google","maps","document","getElementById","htmlId","center","zoom","zoomControl","mapTypeControl","fullscreenControl","clickableIcons","streetViewControl","pan","setMap","marker","Marker","position","icon","title","draggable","panToPos","setZoom","panTo","list","i","length","store","_id","lat","lng","name","push","selected","categories","labels","type","includes","indexOf","typeLabel","icon_hover","id","event","addListener","handleStoreMarkerClick","setIcon","element","alert","findStore","openSelectedStore","height","width","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport distance from './Distance'\n\nconst initialZoom = 15\n\nclass Map extends React.Component {\n\n  constructor(props)\n  {\n    super(props)\n    this.state = {\n      map: null,\n      userMarker:null,\n      storeMarkers:[],\n      selectedStore: null\n    }\n  }\n\n  componentDidMount()\n  {\n    this.setState({map:null}) \n  }\n\n  componentDidUpdate(prevProps, prevState) \n  {\n    if(this.props.pos !== null && (this.props.stores !== null || this.props.selectedStore !== null) )\n    {\n      if(this.state.map === null)\n      {\n        let map=this.getMap(this.props.pos)\n        let userMarker=this.placeUserMarker(map, this.props.pos)\n        let storeMarkers=null \n        let selectedStore=null\n\n        if(this.props.stores!==null)\n        {\n          storeMarkers = this.placeAllStoreMarkers(map, this.props.stores)\n        }\n        console.log(this.props.selectedStore)\n        if(this.props.selectedStore!==null)\n        {\n          selectedStore = this.placeAStoreMarker(map, this.props.selectedStore, true)\n        }\n\n        this.setState ({\n          userMarker:userMarker,\n          map: map,\n          storeMarkers: storeMarkers,\n          selectedStore: selectedStore\n        })\n      }\n      \n      if(this.state.map !== null && prevProps.pos !== this.props.pos)\n      {\n        let userMarker=this.placeUserMarker(this.state.map, this.props.pos)\n        this.removeAllStoreMarkers()\n\n        this.setState ({\n          userMarker:userMarker\n        })\n      }\n\n      if(this.state.map !== null && prevProps.stores !== this.props.stores)\n      {\n        this.removeAllStoreMarkers()\n        let storeMarkers = this.placeAllStoreMarkers(this.state.map, this.props.stores)\n\n        this.setState ({\n          storeMarkers: storeMarkers\n        })\n      }\n      \n      if(this.state.map !== null && prevProps.selectedStore !== this.props.selectedStore)\n      {\n        this.removeSelectedStoreMarker()\n        let selectedStore = this.placeAStoreMarker(this.state.map, this.props.selectedStore)\n\n        this.setState ({\n          selectedStore: selectedStore\n        })\n      }\n    }\n  }\n\n  getMap(pos)\n  {\n    let map = null\n    if(this.state.map == null)\n    {\n      map = new google.maps.Map(document.getElementById(this.props.htmlId), {\n        center: pos,\n        zoom: initialZoom,\n        zoomControl:false,\n        mapTypeControl: false,\n        fullscreenControl: false,\n        clickableIcons: false,\n        streetViewControl: false\n      })\n    }\n    else\n    {\n      map = this.state.map\n    }\n    return map\n  }\n\n  placeUserMarker(map, pos, pan=true)\n  {\n    if(this.state.userMarker != null)\n    {\n      this.state.userMarker.setMap(null);\n    }\n\n    let marker = new google.maps.Marker({\n      position: pos,\n      icon: './map/user_icon.svg',\n      title: \"Tu ubicación\",\n      draggable:false,\n    })\n\n    marker.setMap(map);\n\n    if(pan)\n    {\n      this.panToPos(map, pos)\n    }\n\n    return marker\n  }\n\n  panToPos(map, pos, zoom=initialZoom)\n  {\n    map.setZoom(zoom);\n    map.panTo(pos);\n  }\n\n  placeAllStoreMarkers(map, stores)\n  {\n    let list = []\n    \n    for (let i = 0; i < stores.length; i++) {\n      let store = stores[i]\n      if(store._id == null || store.lat == null || store.lng == null || store.name == null)\n      {\n        console.log(\"Skiped store: \"+store.name)\n        continue\n      }\n\n      let marker = this.placeAStoreMarker(map, store)\n      list.push(marker)\n    }\n\n    return list\n  }\n\n  removeAllStoreMarkers()\n  {\n    for (let i = 0; i < this.state.storeMarkers.length; i++)\n    {\n      this.state.storeMarkers[i].setMap(null)\n    }\n  }\n\n  removeSelectedStoreMarker()\n  {\n    this.state.selectedStore.setMap(null)\n  }\n\n  placeAStoreMarker(map, store, selected=false)\n  {\n    let categories=[\n      'pharmacy', \n      'bakery', \n      'vegetableStore', \n      'hardwareStore',\n      'butchery', \n      'drycleaner',\n      'stationeryStore',\n      'petStore',\n      'liquorStore',\n      'fastFood',\n      'restaurant',\n      'groeceryStore',\n      'store'\n    ]\n\n    let labels=[\n      'Droguería',\n      'Panadería',\n      'Fruver',\n      'Ferretería',\n      'Carnicería',\n      'Lavandería',\n      'Papelería',\n      'Mascotas',\n      'Licorera',\n      'Comida rápida',\n      'Restaurante',\n      'Tienda',\n      'Otro'\n    ]\n\n    if(store.type===null)\n    {\n      store.type=\"store\"\n    }\n\n    if(!categories.includes(store.type))\n    {\n      store.type=\"store\"\n    }\n    \n    let i = categories.indexOf(store.type)\n    store.typeLabel = labels[i]\n\n    let icon = '';\n    if(selected)\n    {\n      icon = './map/' + store.type + \"_icon_selected.svg\";\n    }\n    else\n    {\n      icon = './map/' + store.type + \"_icon.svg\";\n    }\n    let icon_hover = './map/' + store.type + \"_icon_hover.svg\";\n    \n    let marker = new google.maps.Marker({\n      position: {lat:store.lat, lng:store.lng},\n      icon: icon,\n      title:store.name,\n      draggable:false,\n      //custom data\n      selected:selected,\n      id:store._id,\n      distance:distance(this.props.pos.lat, this.props.pos.lng, store.lat, store.lng)\n    })\n\n    google.maps.event.addListener(marker, 'click', function() {\n      if(!marker.selected)\n      {\n        this.handleStoreMarkerClick(marker.id);\n      }\n    })\n\n    google.maps.event.addListener(marker, 'mouseover', function() {\n      marker.setIcon(icon_hover);\n    })\n\n    google.maps.event.addListener(marker, 'mouseout', function() {\n      marker.setIcon(icon);    \n    })\n\n    marker.setMap(map)\n    return marker\n  }\n\n  findStore(id)\n  {\n    for (let i = 0; i < this.props.stores.length; i++) {\n      const element = this.props.stores[i];\n\n      if(element._id === id)\n      {\n        return element\n      }\n    }\n    return null\n  }\n\n  handleStoreMarkerClick(id)\n  {\n    alert(\"ya merito\")\n    let store = this.findStore()\n\n    if(store !== null)\n    {\n      alert(\"ya mero merito\")\n      this.props.openSelectedStore(store)\n    }\n  }\n\n  render () {\n    return (\n      <div style={{height:\"100%\", width:'100%'}}>\n        <div id={this.props.htmlId} style={{height:\"100%\", width:'100%'}}></div>\n      </div>\n    )\n  }\n}\n\nexport default Map\n"]},"metadata":{},"sourceType":"module"}