{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/crmock/pideenlaequina/front/components/ContextProvider.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport Context from \"./Context\";\nimport createAuth0Client from '@auth0/auth0-spa-js'; // create a provider\n\nvar ContextProvider = /*#__PURE__*/function (_Component) {\n  _inherits(ContextProvider, _Component);\n\n  var _super = _createSuper(ContextProvider);\n\n  function ContextProvider(props) {\n    var _this;\n\n    _classCallCheck(this, ContextProvider);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"deviceLocation\", function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(navigator.geolocation.getCurrentPosition(function (position) {\n                return _this.locationFromBrowser(position);\n              }, function (err) {\n                return _this.locationFromIp();\n              }));\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"initializeAuth0\", function _callee2() {\n      var config, auth0Client, isAuthenticated, user;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              config = {\n                domain: 'acacerca.auth0.com',\n                //process.env.AUTH0_DOMAIN,\n                client_id: 'd8Pv88MjaYWNSUKUHnO9JcudrUPZ6THl',\n                //process.env.AUTH0_CLIENT_ID,\n                redirect_uri: window.location.origin,\n                cacheLocation: 'localstorage'\n              };\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(createAuth0Client(config));\n\n            case 3:\n              auth0Client = _context2.sent;\n              _context2.next = 6;\n              return _regeneratorRuntime.awrap(auth0Client.isAuthenticated());\n\n            case 6:\n              isAuthenticated = _context2.sent;\n\n              if (!isAuthenticated) {\n                _context2.next = 13;\n                break;\n              }\n\n              _context2.next = 10;\n              return _regeneratorRuntime.awrap(auth0Client.getUser());\n\n            case 10:\n              _context2.t0 = _context2.sent;\n              _context2.next = 14;\n              break;\n\n            case 13:\n              _context2.t0 = null;\n\n            case 14:\n              user = _context2.t0;\n\n              _this.setState({\n                authClient: auth0Client,\n                isAuthenticated: isAuthenticated,\n                user: user\n              });\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    _this.state = {\n      deviceLocation: null,\n      selectedLocation: null,\n      featuredStores: null,\n      stores: null,\n      orders: null,\n      authClient: null,\n      isAuthenticated: false,\n      user: null,\n      isReady: false\n    };\n    _this.startedAt = new Date();\n    return _this;\n  }\n\n  _createClass(ContextProvider, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.deviceLocation();\n      this.initializeAuth0();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      if (this.state.authClient !== null && this.state.deviceLocation !== null && this.state.selectedLocation === null) {\n        console.log(this.state.user);\n\n        if (this.state.user !== null && this.state.user.addresses !== null && this.state.user.addresses !== []) {\n          var _location = this.state.user.addresses[0];\n        } else {\n          var _location2 = this.state.deviceLocation;\n        }\n\n        this.updateSelectedLocation(location.lat, location.lng, location.address, location.type);\n      }\n\n      if (this.state.selectedLocation !== null && prevState.selectedLocation !== this.state.selectedLocation) {\n        this.featuredStores(this.state.selectedLocation.lat, this.state.selectedLocation.lng);\n        this.stores(this.state.selectedLocation.lat, this.state.selectedLocation.lng);\n      }\n\n      if (!this.state.isReady && this.state.selectedLocation !== null && this.state.stores !== null && this.state.featuredStores !== null) {\n        var now = new Date();\n        var towait = 2000 - (now.getTime() - this.startedAt.getTime());\n\n        if (towait > 0) {\n          setTimeout(function () {\n            _this2.setState({\n              isReady: true\n            });\n          }, towait);\n        } else {\n          this.setState({\n            isReady: true\n          });\n        }\n      }\n    }\n  }, {\n    key: \"updateSelectedLocation\",\n    value: function updateSelectedLocation(newLat, newLng, address, type) {\n      var location = {\n        lat: parseFloat(newLat),\n        lng: parseFloat(newLng),\n        address: address,\n        type: type\n      };\n      this.setState({\n        selectedLocation: location\n      }); //localStorage.setItem('_selectedLocationL', location)  \n    }\n  }, {\n    key: \"updateDeviceLocation\",\n    value: function updateDeviceLocation(newLat, newLng, address) {\n      var location = {\n        lat: parseFloat(newLat),\n        lng: parseFloat(newLng),\n        address: address,\n        type: \"device\"\n      };\n      this.setState({\n        deviceLocation: location\n      }); //localStorage.setItem('_deviceLocation', location)  \n    }\n  }, {\n    key: \"locationFromIp\",\n    value: function locationFromIp() {\n      var url, res, address;\n      return _regeneratorRuntime.async(function locationFromIp$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              url = '/api/locationFromIp';\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(fetch(url).then(function (response) {\n                return response.json();\n              }));\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return _regeneratorRuntime.awrap(this.addressFromLocation(lat, lng));\n\n            case 6:\n              address = _context3.sent;\n              this.updateDeviceLocation(res.location.lat, res.location.lng, address);\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"locationFromBrowser\",\n    value: function locationFromBrowser(position) {\n      var lat, lng, address;\n      return _regeneratorRuntime.async(function locationFromBrowser$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              lat = position.coords.latitude;\n              lng = position.coords.longitude;\n              _context4.next = 4;\n              return _regeneratorRuntime.awrap(this.addressFromLocation(lat, lng));\n\n            case 4:\n              address = _context4.sent;\n              this.updateDeviceLocation(lat, lng, address);\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"addressFromLocation\",\n    value: function addressFromLocation(lat, lng) {\n      var url, res;\n      return _regeneratorRuntime.async(function addressFromLocation$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              url = '/api/addressFromLocation?lat=' + lat + '&lng=' + lng;\n              _context5.next = 3;\n              return _regeneratorRuntime.awrap(fetch(url).then(function (response) {\n                return response.json();\n              }));\n\n            case 3:\n              res = _context5.sent;\n              return _context5.abrupt(\"return\", res.address);\n\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, {\n    key: \"featuredStores\",\n    value: function featuredStores(lat, lng) {\n      var url, res;\n      return _regeneratorRuntime.async(function featuredStores$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              url = '/api/featuredStores?lat=' + lat + '&lng=' + lng;\n              _context6.next = 3;\n              return _regeneratorRuntime.awrap(fetch(url).then(function (response) {\n                return response.json();\n              }));\n\n            case 3:\n              res = _context6.sent;\n              this.setState({\n                featuredStores: res.stores\n              }); //localStorage.setItem('_featuredStores', JSON.stringify(res.stores))  \n\n            case 5:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"stores\",\n    value: function stores(lat, lng) {\n      var url, res;\n      return _regeneratorRuntime.async(function stores$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              url = '/api/stores?lat=' + lat + '&lng=' + lng;\n              _context7.next = 3;\n              return _regeneratorRuntime.awrap(fetch(url).then(function (response) {\n                return response.json();\n              }));\n\n            case 3:\n              res = _context7.sent;\n              this.setState({\n                stores: res.stores\n              }); //localStorage.setItem('_stores', JSON.stringify(res.stores))  \n\n            case 5:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          deviceLocation = _this$state.deviceLocation,\n          selectedLocation = _this$state.selectedLocation,\n          featuredStores = _this$state.featuredStores,\n          stores = _this$state.stores,\n          orders = _this$state.orders,\n          authClient = _this$state.authClient,\n          isAuthenticated = _this$state.isAuthenticated,\n          user = _this$state.user,\n          isReady = _this$state.isReady;\n      var values = {\n        deviceLocation: deviceLocation,\n        selectedLocation: selectedLocation,\n        featuredStores: featuredStores,\n        stores: stores,\n        orders: orders,\n        isAuthenticated: isAuthenticated,\n        user: user,\n        isReady: isReady,\n        loginWithRedirect: function loginWithRedirect() {\n          return authClient.loginWithRedirect.apply(authClient, arguments);\n        },\n        getTokenSilently: function getTokenSilently() {\n          return authClient.getTokenSilently.apply(authClient, arguments);\n        },\n        getIdTokenClaims: function getIdTokenClaims() {\n          return authClient.getIdTokenClaims.apply(authClient, arguments);\n        },\n        logout: function logout() {\n          return authClient.logout.apply(authClient, arguments);\n        }\n      };\n      return __jsx(Context.Provider, {\n        value: values,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }\n      }, \":)\");\n    }\n  }]);\n\n  return ContextProvider;\n}(Component);\n\nexport default ContextProvider;","map":{"version":3,"sources":["/home/crmock/pideenlaequina/front/components/ContextProvider.js"],"names":["React","Component","Context","createAuth0Client","ContextProvider","props","navigator","geolocation","getCurrentPosition","position","locationFromBrowser","err","locationFromIp","config","domain","client_id","redirect_uri","window","location","origin","cacheLocation","auth0Client","isAuthenticated","getUser","user","setState","authClient","state","deviceLocation","selectedLocation","featuredStores","stores","orders","isReady","startedAt","Date","initializeAuth0","prevProps","prevState","console","log","addresses","updateSelectedLocation","lat","lng","address","type","now","towait","getTime","setTimeout","newLat","newLng","parseFloat","url","fetch","then","response","json","res","addressFromLocation","updateDeviceLocation","coords","latitude","longitude","values","loginWithRedirect","getTokenSilently","getIdTokenClaims","logout"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nimport Context from \"./Context\"\nimport createAuth0Client from '@auth0/auth0-spa-js';\n\n// create a provider\nclass ContextProvider extends Component {\n   \n  constructor(props)\n  {\n    super(props)\n    this. state = {\n      deviceLocation:null,\n      selectedLocation:null,\n\n      featuredStores:null,\n      stores:null,\n      orders:null,\n\n      authClient: null,\n      isAuthenticated: false,\n      user:null,\n\n      isReady:false\n    }\n    \n    this.startedAt = new Date()\n  }\n\n  componentDidMount() {\n    this.deviceLocation()\n    this.initializeAuth0()\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(this.state.authClient!==null\n      && this.state.deviceLocation!==null\n      && this.state.selectedLocation===null)\n    { \n      console.log(this.state.user)\n      if(this.state.user!==null\n        && this.state.user.addresses!==null\n        && this.state.user.addresses!==[])\n      {\n        let location = this.state.user.addresses[0]\n      }\n      else\n      {\n        let location = this.state.deviceLocation\n      }\n      this.updateSelectedLocation(location.lat, location.lng, location.address, location.type)\n    }\n    \n    if(this.state.selectedLocation !== null  \n      && (prevState.selectedLocation !== this.state.selectedLocation))\n    {\n      this.featuredStores(this.state.selectedLocation.lat, this.state.selectedLocation.lng)\n      this.stores(this.state.selectedLocation.lat, this.state.selectedLocation.lng)\n    }\n\n    if(\n        !this.state.isReady \n        && this.state.selectedLocation !== null\n        && this.state.stores !== null\n        && this.state.featuredStores !== null)\n    {\n      let now = new Date()\n      let towait = 2000 - (now.getTime() - this.startedAt.getTime())\n      \n      if(towait>0)\n      {\n        setTimeout(() => {\n          this.setState({ isReady:true })\n        }, towait)\n      }\n      else\n      {\n        this.setState({ isReady:true })\n      }\n    }\n  }\n  \n  deviceLocation = async () => {\n    await navigator.geolocation.getCurrentPosition(\n      position => this.locationFromBrowser(position), \n      err => this.locationFromIp()\n    )\n  }\n\n  updateSelectedLocation(newLat, newLng, address, type)\n  {\n    let location = {\n      lat:parseFloat(newLat), \n      lng:parseFloat(newLng),\n      address: address,\n      type: type\n    }\n\n    this.setState({ \n      selectedLocation:location\n    })\n\n    //localStorage.setItem('_selectedLocationL', location)  \n  }\n\n  updateDeviceLocation(newLat, newLng, address)\n  {\n    let location = {\n      lat:parseFloat(newLat), \n      lng:parseFloat(newLng),\n      address: address,\n      type: \"device\"\n    }\n\n    this.setState({ \n      deviceLocation:location\n    })\n\n    //localStorage.setItem('_deviceLocation', location)  \n  }\n\n  initializeAuth0 = async () => {\n    const config = {\n      domain: 'acacerca.auth0.com',//process.env.AUTH0_DOMAIN,\n      client_id: 'd8Pv88MjaYWNSUKUHnO9JcudrUPZ6THl',//process.env.AUTH0_CLIENT_ID,\n      redirect_uri: window.location.origin,\n      cacheLocation: 'localstorage'\n    }\n\n    const auth0Client = await createAuth0Client(config)\n    const isAuthenticated = await auth0Client.isAuthenticated()\n    const user = isAuthenticated ? await auth0Client.getUser() : null\n\n    this.setState({ authClient:auth0Client, isAuthenticated, user })\n  }\n\n  async locationFromIp()\n  {\n    let url = '/api/locationFromIp'\n    let res = await fetch(url).then(response=>response.json())\n    let address = await this.addressFromLocation(lat,lng)\n\n    this.updateDeviceLocation(res.location.lat, res.location.lng, address)\n  }\n\n  async locationFromBrowser(position)\n  {\n    let lat = position.coords.latitude\n    let lng = position.coords.longitude\n    let address = await this.addressFromLocation(lat,lng)\n\n    this.updateDeviceLocation(lat, lng, address)\n  }\n\n  async addressFromLocation(lat, lng)\n  {\n    let url = '/api/addressFromLocation?lat='+ lat +'&lng='+lng\n    let res = await fetch(url).then(response=>response.json())\n\n    return res.address\n  }\n\n  async featuredStores(lat, lng)\n  {\n    let url = '/api/featuredStores?lat='+ lat +'&lng='+lng\n    let res = await fetch(url).then(response=>response.json())\n    \n    this.setState({ featuredStores:res.stores })\n    //localStorage.setItem('_featuredStores', JSON.stringify(res.stores))  \n  }\n\n  async stores(lat, lng)\n  {\n    let url = '/api/stores?lat='+ lat +'&lng='+lng\n    let res = await fetch(url).then(response=>response.json())\n    \n    this.setState({ stores:res.stores })\n    //localStorage.setItem('_stores', JSON.stringify(res.stores))  \n  }\n\n  render() {\n    const { \n      deviceLocation,\n      selectedLocation,\n      featuredStores,\n      stores,\n      orders,\n\n      authClient,\n      isAuthenticated,\n      user,\n\n      isReady\n    } = this.state;\n\n    const values = { \n      deviceLocation,\n      selectedLocation,\n      featuredStores,\n      stores,\n      orders,\n\n      isAuthenticated,\n      user,\n\n      isReady,\n\n      loginWithRedirect: (...p) => authClient.loginWithRedirect(...p),\n      getTokenSilently: (...p) => authClient.getTokenSilently(...p),\n      getIdTokenClaims: (...p) => authClient.getIdTokenClaims(...p),\n      logout: (...p) => authClient.logout(...p)\n    }\n\n    return (<Context.Provider value={values}>:)</Context.Provider>);\n  }\n}\n\nexport default ContextProvider"]},"metadata":{},"sourceType":"module"}