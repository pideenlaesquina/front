{"version":3,"file":"static/webpack/static/development/pages/index.js.784c426af7ffe1a8ffae.hot-update.js","sources":["webpack:///./components/map.js"],"sourcesContent":["import React from 'react'\nimport ReactDOM from 'react-dom'\nimport Head from 'next/head'\nimport AddressBar from '../components/addressBar.js'\nimport NoStores from '../components/noStores.js'\n\nclass Map extends React.Component {\n\n  constructor(props)\n  {\n    super(props)\n    this.state = {\n      map: null,\n      userMarker:null,\n      storeMarkers:[]\n    }\n  }\n\n  shouldComponentUpdate() {\n    if(this.props.pos == null)\n    {\n      return false\n    }\n    return true\n  }\n\n  componentDidUpdate(prevProps, prevState) \n  {\n    if(this.props.pos != null && this.props.stores != null)\n    {\n      if(this.state.map == null)\n      {\n        let map=this.getMap(this.props.pos)\n        let userMarker=this.placeUserMarker(map, this.props.pos)\n        let storeMarkers = this.placeAllStoreMarkers(map, this.props.stores)\n\n        this.setState ({\n          userMarker:userMarker,\n          map: map,\n          storeMarkers: storeMarkers\n        })\n      }\n      else if(prevProps.pos != this.props.pos)\n      {\n        let userMarker=this.placeUserMarker(this.state.map, this.props.pos)\n        this.removeAllStoreMarkers()\n        let storeMarkers = this.placeAllStoreMarkers(this.state.map, this.props.stores)\n\n        this.setState ({\n          userMarker:userMarker,\n          storeMarkers: storeMarkers\n        })\n      }\n    }\n  }\n\n  getMap(pos)\n  {\n    let map = null\n    if(this.state.map == null)\n    {\n      map = new google.maps.Map(document.getElementById('map'), {\n        center: pos,\n        zoom: 15,\n        mapTypeControl: false,\n        fullscreenControl: false,\n        clickableIcons: false,\n        streetViewControl: false\n      })\n    }\n    else\n    {\n      map = this.state.map\n    }\n    return map\n  }\n\n  placeUserMarker(map, pos)\n  {\n    if(this.state.userMarker != null)\n    {\n      this.state.userMarker.setMap(null);\n    }\n\n    let marker = new google.maps.Marker({\n      position: pos,\n      icon: './map/user_icon.svg',\n      title: \"Tu ubicación\",\n      draggable:false,\n    })\n\n    marker.setMap(map);\n    this.panToPos(map, pos)\n\n    return marker\n  }\n\n  panToPos(map, pos)\n  {\n    map.panTo(pos);\n  }\n\n  placeAllStoreMarkers(map, stores)\n  {\n    let list = []\n    \n    for (let i = 0; i < stores.length; i++) {\n      let store = stores[i]\n      if(store._id == null || store.lat == null || store.lng == null || store.name == null)\n      {\n        console.log(\"Skiped store: \"+store.name)\n        continue\n      }\n\n      let marker = this.placeAStoreMarker(map, store)\n      list.push(marker)\n    }\n\n    return list\n  }\n\n  removeAllStoreMarkers()\n  {\n    for (let i = 0; i < this.state.storeMarkers.length; i++)\n    {\n      this.state.storeMarkers[i].setMap(null)\n    }\n  }\n\n  placeAStoreMarker(map, store)\n  {\n    store.type = (store.type==null?\"store\":store.type.toLowerCase())\n    let icon_normal = './map/' + store.type + \"_icon.svg\";\n    let icon_hover = './map/' + store.type + \"_icon_hover.svg\";\n    \n    let marker = new google.maps.Marker({\n      position: {lat:store.lat, lng:store.lng},\n      icon: icon_normal,\n      title:store.name,\n      draggable:false,\n      id:store.id, //custom data\n    })\n\n    google.maps.event.addListener(marker, 'click', function() {\n      console.log(\"click \" +marker.id)       \n    })\n\n    google.maps.event.addListener(marker, 'mouseover', function() {\n      marker.setIcon(icon_hover);\n    })\n\n    google.maps.event.addListener(marker, 'mouseout', function() {\n      marker.setIcon(icon_normal);    \n    })\n\n    marker.setMap(map)\n    return marker\n  }\n\n  render () {\n    let customStyle = {\n      padding:\"0\",\n      margin:\"0\",\n      display: 'flex',\n      height: '97vh',\n\n      alignItems:'center', \n      justifyContent: 'center',\n      \n      background:'WhiteSmoke'\n    }\n\n    let imageStyle = {\n      width: \"50%\",\n      marginLeft:\"auto\",\n      marginRight: \"auto\"\n    }\n\n    let google_url = process.env.GOOGLE_MAPS_API_URL + \"/js?key=\"+process.env.GOOGLE_MAPS_API_KEY\n    \n    return (\n      <div>\n        <Head>\n          <script src= {google_url}></script>\n        </Head>\n        <div>\n          <div id=\"map\" style={customStyle}>\n            <img src=\"/loading.svg\" alt=\"Pajarito escuchando música feliz\" style={imageStyle}></img>\n          </div>\n          {this.state.map\n            ?<AddressBar/>\n            :\"\"\n          }\n          {this.state.map && this.props.stores.length==0\n            ?<NoStores/>\n            :\"\"\n          }\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Map\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAEA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAOA;AACA;;;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;;;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;;;AAEA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AAGA;AACA;AACA;AAAA;AACA;;;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AAEA;AACA;;;AAEA;AAEA;AACA;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AAEA;AACA;AACA;;;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AATA;AAYA;AACA;AACA;AACA;AAHA;AAMA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;;;;AAlMA;AACA;AAoMA;;;;;A","sourceRoot":""}